{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% load humanize %}
{% load core_filters %}

{% block title %}
{% if LANGUAGE_CODE == 'ar' %}{{ listing.trim.model.make.name_ar }} {{ listing.trim.model.name_ar }}{% else %}{{ listing.trim.model.make.name_en }} {{ listing.trim.model.name_en }}{% endif %} - Abo Raaya Motors
{% endblock %}

{% block extra_css %}
<style>
.detail-hero { position: relative; margin-bottom: 2rem; }
.gallery-container { background: rgba(255, 255, 255, 0.02); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 24px; overflow: hidden; }
.main-image-container { position: relative; height: 500px; background: linear-gradient(135deg, #1a1f35 0%, #0d1020 100%); }
.main-image-container img { width: 100%; height: 100%; object-fit: cover; }
.main-image-placeholder { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; }
.main-image-placeholder i { font-size: 6rem; color: rgba(255, 255, 255, 0.1); }
.image-counter { position: absolute; bottom: 1rem; right: 1rem; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(8px); padding: 0.5rem 1rem; border-radius: 20px; color: white; font-size: 0.875rem; }
.carousel-control-prev, .carousel-control-next { width: 50px; height: 50px; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(8px); border-radius: 50%; top: 50%; transform: translateY(-50%); opacity: 0; transition: all 0.3s ease; }
.gallery-container:hover .carousel-control-prev, .gallery-container:hover .carousel-control-next { opacity: 1; }
.carousel-control-prev { left: 1rem; }
.carousel-control-next { right: 1rem; }
.carousel-control-prev:hover, .carousel-control-next:hover { background: var(--electric-blue); }
.thumbnail-strip { display: flex; gap: 0.5rem; padding: 1rem; overflow-x: auto; background: rgba(0, 0, 0, 0.3); }
.thumbnail-strip::-webkit-scrollbar { height: 4px; }
.thumbnail-strip::-webkit-scrollbar-thumb { background: var(--electric-blue); border-radius: 2px; }
.thumbnail { width: 80px; height: 60px; border-radius: 8px; overflow: hidden; cursor: pointer; border: 2px solid transparent; transition: all 0.3s ease; flex-shrink: 0; }
.thumbnail.active, .thumbnail:hover { border-color: var(--electric-blue); }
.thumbnail img { width: 100%; height: 100%; object-fit: cover; }
.quick-actions { position: absolute; top: 1rem; right: 1rem; display: flex; gap: 0.5rem; z-index: 10; }
.quick-action-btn { width: 44px; height: 44px; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(8px); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; cursor: pointer; transition: all 0.3s ease; }
.quick-action-btn:hover { background: var(--electric-blue); border-color: var(--electric-blue); transform: scale(1.1); }
.quick-action-btn.active { background: #ef4444; border-color: #ef4444; }
.content-section { margin-bottom: 2rem; }
.section-card { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 20px; padding: 2rem; }
.section-title { font-size: 1.5rem; font-weight: 700; color: var(--white); margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.75rem; }
.section-title i { color: var(--electric-blue); }
.spec-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; }
.spec-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.06); border-radius: 16px; padding: 1.25rem; transition: all 0.3s ease; }
.spec-card:hover { border-color: var(--electric-blue); transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0, 212, 255, 0.1); }
.spec-icon { width: 48px; height: 48px; background: rgba(0, 212, 255, 0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 1rem; }
.spec-icon i { font-size: 1.5rem; color: var(--electric-blue); }
.spec-label { font-size: 0.8rem; color: rgba(255, 255, 255, 0.5); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.25rem; }
.spec-value { font-size: 1.125rem; font-weight: 700; color: var(--white); }
.description-text { color: rgba(255, 255, 255, 0.7); line-height: 1.8; font-size: 1rem; }
.sidebar-sticky { position: sticky; top: 100px; }
.price-card { background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(0, 212, 255, 0.05) 100%); backdrop-filter: blur(20px); border: 1px solid rgba(0, 212, 255, 0.2); border-radius: 24px; padding: 2rem; margin-bottom: 1.5rem; }
.price-display { font-size: 2.5rem; font-weight: 800; background: linear-gradient(135deg, var(--amber-gold) 0%, #ffcc00 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 0.5rem; }
.car-name-sidebar { font-size: 1.25rem; font-weight: 600; color: var(--white); margin-bottom: 1.5rem; }
.badge-row { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1.5rem; }
.smart-badge { padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600; display: inline-flex; align-items: center; gap: 0.5rem; }
.badge-fuel-saver { background: rgba(34, 197, 94, 0.15); color: #22c55e; }
.badge-performance { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
.badge-electric { background: rgba(0, 212, 255, 0.15); color: #00d4ff; }
.badge-low-mileage { background: rgba(168, 85, 247, 0.15); color: #a855f7; }
.btn-contact { width: 100%; padding: 1rem 1.5rem; background: linear-gradient(135deg, var(--electric-blue) 0%, #0099cc 100%); border: none; border-radius: 14px; color: white; font-weight: 700; font-size: 1.1rem; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 0.75rem; margin-bottom: 1rem; }
.btn-contact:hover { transform: translateY(-2px); box-shadow: 0 12px 30px rgba(0, 212, 255, 0.3); }
.btn-whatsapp { background: linear-gradient(135deg, #25D366 0%, #128C7E 100%); }
.btn-whatsapp:hover { box-shadow: 0 12px 30px rgba(37, 211, 102, 0.3); }
.seller-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 16px; padding: 1.5rem; }
.seller-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; }
.seller-avatar { width: 56px; height: 56px; background: linear-gradient(135deg, var(--electric-blue) 0%, #0099cc 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: white; }
.seller-name { font-weight: 600; color: var(--white); font-size: 1.1rem; }
.seller-badge { display: inline-flex; align-items: center; gap: 0.25rem; font-size: 0.75rem; color: #22c55e; }
.seller-stats { display: flex; gap: 1.5rem; padding-top: 1rem; border-top: 1px solid rgba(255, 255, 255, 0.08); }
.stat-item { text-align: center; }
.stat-value { font-size: 1.25rem; font-weight: 700; color: var(--white); }
.stat-label { font-size: 0.75rem; color: rgba(255, 255, 255, 0.5); }
.related-section { margin-top: 3rem; }
.related-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; }
.related-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 16px; overflow: hidden; transition: all 0.3s ease; }
.related-card:hover { transform: translateY(-4px); border-color: var(--electric-blue); }
.related-img { height: 180px; background: linear-gradient(135deg, #1a1f35 0%, #0d1020 100%); overflow: hidden; }
.related-img img { width: 100%; height: 100%; object-fit: cover; }
.related-body { padding: 1.25rem; }
.related-price { font-size: 1.25rem; font-weight: 700; color: var(--amber-gold); margin-bottom: 0.5rem; }
.related-title { font-size: 1rem; font-weight: 600; color: var(--white); margin-bottom: 1rem; }
.related-link { display: block; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 10px; color: var(--white); text-align: center; text-decoration: none; transition: all 0.3s ease; }
.related-link:hover { background: var(--electric-blue); border-color: var(--electric-blue); color: white; }
@media (max-width: 768px) {
.main-image-container { height: 300px; }
.price-display { font-size: 2rem; }
.spec-grid { grid-template-columns: repeat(2, 1fr); }
}
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
<div class="row">
<div class="col-lg-8">
<div class="detail-hero">
<div class="gallery-container">
<div class="quick-actions">
<button class="quick-action-btn" title="{% trans 'Share' %}"><i class="bi bi-share"></i></button>
<button class="quick-action-btn" title="{% trans 'Save' %}"><i class="bi bi-heart"></i></button>
<button class="quick-action-btn" title="{% trans 'Compare' %}"><i class="bi bi-arrow-left-right"></i></button>
</div>
{% if listing.image_main|has_file or listing.image_2|has_file or listing.image_3|has_file or listing.image_4|has_file or listing.image_5|has_file %}
<div id="carouselImages" class="carousel slide" data-bs-ride="false">
<div class="carousel-inner">
{% if listing.image_main|has_file %}<div class="carousel-item active"><div class="main-image-container"><img src="{{ listing.image_main.url }}" alt="Main"></div></div>{% endif %}
{% if listing.image_2|has_file %}<div class="carousel-item"><div class="main-image-container"><img src="{{ listing.image_2.url }}" alt="Image 2"></div></div>{% endif %}
{% if listing.image_3|has_file %}<div class="carousel-item"><div class="main-image-container"><img src="{{ listing.image_3.url }}" alt="Image 3"></div></div>{% endif %}
{% if listing.image_4|has_file %}<div class="carousel-item"><div class="main-image-container"><img src="{{ listing.image_4.url }}" alt="Image 4"></div></div>{% endif %}
{% if listing.image_5|has_file %}<div class="carousel-item"><div class="main-image-container"><img src="{{ listing.image_5.url }}" alt="Image 5"></div></div>{% endif %}
</div>
<button class="carousel-control-prev" type="button" data-bs-target="#carouselImages" data-bs-slide="prev"><span class="carousel-control-prev-icon"></span></button>
<button class="carousel-control-next" type="button" data-bs-target="#carouselImages" data-bs-slide="next"><span class="carousel-control-next-icon"></span></button>
</div>
<div class="thumbnail-strip">
{% if listing.image_main|has_file %}<div class="thumbnail active" data-bs-target="#carouselImages" data-bs-slide-to="0"><img src="{{ listing.image_main.url }}" alt="Thumb 1"></div>{% endif %}
{% if listing.image_2|has_file %}<div class="thumbnail" data-bs-target="#carouselImages" data-bs-slide-to="1"><img src="{{ listing.image_2.url }}" alt="Thumb 2"></div>{% endif %}
{% if listing.image_3|has_file %}<div class="thumbnail" data-bs-target="#carouselImages" data-bs-slide-to="2"><img src="{{ listing.image_3.url }}" alt="Thumb 3"></div>{% endif %}
{% if listing.image_4|has_file %}<div class="thumbnail" data-bs-target="#carouselImages" data-bs-slide-to="3"><img src="{{ listing.image_4.url }}" alt="Thumb 4"></div>{% endif %}
{% if listing.image_5|has_file %}<div class="thumbnail" data-bs-target="#carouselImages" data-bs-slide-to="4"><img src="{{ listing.image_5.url }}" alt="Thumb 5"></div>{% endif %}
</div>
{% else %}
<div class="main-image-container"><div class="main-image-placeholder"><i class="bi bi-car-front"></i></div></div>
{% endif %}
</div>
</div>

<div class="content-section">
<div class="section-card">
<h2 class="section-title"><i class="bi bi-file-text"></i> {% trans "Description" %}</h2>
<div class="description-text">{{ listing.description|linebreaks }}</div>
</div>
</div>

<div class="content-section">
<div class="section-card">
<h2 class="section-title"><i class="bi bi-sliders"></i> {% trans "Specifications" %}</h2>
<div class="spec-grid">
<div class="spec-card"><div class="spec-icon"><i class="bi bi-calendar3"></i></div><div class="spec-label">{% trans "Year" %}</div><div class="spec-value">{{ listing.trim.year }}</div></div>
<div class="spec-card"><div class="spec-icon"><i class="bi bi-speedometer2"></i></div><div class="spec-label">{% trans "Odometer" %}</div><div class="spec-value">{{ listing.odometer|intcomma }} {% trans "km" %}</div></div>
<div class="spec-card"><div class="spec-icon"><i class="bi bi-gear-wide-connected"></i></div><div class="spec-label">{% trans "Transmission" %}</div><div class="spec-value">{{ listing.trim.get_transmission_display }}</div></div>
<div class="spec-card"><div class="spec-icon"><i class="bi bi-fuel-pump"></i></div><div class="spec-label">{% trans "Fuel Type" %}</div><div class="spec-value">{{ listing.trim.get_fuel_type_display }}</div></div>
<div class="spec-card"><div class="spec-icon"><i class="bi bi-ev-front"></i></div><div class="spec-label">{% trans "Engine" %}</div><div class="spec-value">{{ listing.trim.engine_cc }} cc</div></div>
<div class="spec-card"><div class="spec-icon"><i class="bi bi-lightning-charge"></i></div><div class="spec-label">{% trans "Horsepower" %}</div><div class="spec-value">{{ listing.trim.horsepower }} HP</div></div>
<div class="spec-card"><div class="spec-icon"><i class="bi bi-droplet"></i></div><div class="spec-label">{% trans "Fuel Economy" %}</div><div class="spec-value">{{ listing.trim.fuel_consumption }} L/100km</div></div>
<div class="spec-card"><div class="spec-icon"><i class="bi bi-palette"></i></div><div class="spec-label">{% trans "Color" %}</div><div class="spec-value">{{ listing.color }}</div></div>
<div class="spec-card"><div class="spec-icon"><i class="bi bi-geo-alt"></i></div><div class="spec-label">{% trans "Location" %}</div><div class="spec-value">{{ listing.get_location_display }}</div></div>
</div>
</div>
</div>
</div>

<div class="col-lg-4">
<div class="sidebar-sticky">
<div class="price-card">
<div class="price-display">{{ listing.price|intcomma }} {% trans "EGP" %}</div>
<div class="car-name-sidebar">{% if LANGUAGE_CODE == 'ar' %}{{ listing.trim.model.make.name_ar }} {{ listing.trim.model.name_ar }}{% else %}{{ listing.trim.model.make.name_en }} {{ listing.trim.model.name_en }}{% endif %} - {{ listing.trim.name }}</div>
<div class="badge-row">
{% if listing.trim.fuel_consumption < 6.5 %}<span class="smart-badge badge-fuel-saver"><i class="bi bi-fuel-pump"></i> {% trans "Fuel Saver" %}</span>{% endif %}
{% if listing.trim.horsepower > 250 %}<span class="smart-badge badge-performance"><i class="bi bi-speedometer"></i> {% trans "High Performance" %}</span>{% endif %}
{% if listing.trim.fuel_type == 'ELECTRIC' %}<span class="smart-badge badge-electric"><i class="bi bi-lightning-charge"></i> {% trans "Electric" %}</span>{% endif %}
{% if listing.odometer < 50000 %}<span class="smart-badge badge-low-mileage"><i class="bi bi-star-fill"></i> {% trans "Low Mileage" %}</span>{% endif %}
</div>
<button onclick="revealPhone({{ listing.pk }}, this)" class="btn-contact"><i class="bi bi-telephone-fill"></i> {% trans "Show Phone Number" %}</button>
<a href="https://wa.me/?text={% trans 'I am interested in' %} {{ listing.trim }}" target="_blank" class="btn-contact btn-whatsapp"><i class="bi bi-whatsapp"></i> {% trans "WhatsApp" %}</a>
</div>

<div class="seller-card">
<div class="seller-header">
<div class="seller-avatar"><i class="bi bi-person"></i></div>
<div>
<div class="seller-name">{{ listing.seller.username }}</div>
{% if listing.seller.is_verified_dealer %}<span class="seller-badge"><i class="bi bi-patch-check-fill"></i> {% trans "Verified Dealer" %}</span>{% endif %}
</div>
</div>
<div class="seller-stats">
<div class="stat-item"><div class="stat-value">{{ listing.views }}</div><div class="stat-label">{% trans "Views" %}</div></div>
<div class="stat-item"><div class="stat-value">{{ listing.created_at|timesince }}</div><div class="stat-label">{% trans "Listed" %}</div></div>
</div>
</div>
</div>
</div>
</div>

{% if related_listings %}
<div class="related-section">
<h2 class="section-title"><i class="bi bi-collection"></i> {% trans "Similar Listings" %}</h2>
<div class="related-grid">
{% for related in related_listings %}
<div class="related-card">
<div class="related-img">{% if related.image_main|has_file %}<img src="{{ related.image_main.url }}" alt="{{ related.trim }}">{% else %}<div style="height:100%;display:flex;align-items:center;justify-content:center;"><i class="bi bi-car-front" style="font-size:3rem;color:rgba(255,255,255,0.1);"></i></div>{% endif %}</div>
<div class="related-body">
<div class="related-price">{{ related.price|intcomma }} {% trans "EGP" %}</div>
<div class="related-title">{% if LANGUAGE_CODE == 'ar' %}{{ related.trim.model.make.name_ar }} {{ related.trim.model.name_ar }}{% else %}{{ related.trim.model.make.name_en }} {{ related.trim.model.name_en }}{% endif %}</div>
<a href="{% url 'core:listing_detail' related.pk %}" class="related-link">{% trans "View Details" %}</a>
</div>
</div>
{% endfor %}
</div>
</div>
{% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
document.querySelectorAll('.thumbnail').forEach((thumb, index) => {
thumb.addEventListener('click', function() {
document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
this.classList.add('active');
});
});
document.getElementById('carouselImages')?.addEventListener('slid.bs.carousel', function(e) {
document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
document.querySelectorAll('.thumbnail')[e.to]?.classList.add('active');
});
</script>
{% endblock %}
