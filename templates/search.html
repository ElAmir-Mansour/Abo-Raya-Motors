{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% load static i18n humanize core_filters %}



{% block title %}
{% if LANGUAGE_CODE == 'ar' %}Ø¨Ø­Ø« Ø¹Ù† Ø³ÙŠØ§Ø±Ø§Øª{% else %}Search Cars{% endif %} - Abo Raaya Motors
{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Header with results count -->
    <div class="mb-4">
        <h1 class="text-white mb-2">
            {% if LANGUAGE_CODE == 'ar' %}
            Ø§Ø¨Ø­Ø« Ø¹Ù† Ø³ÙŠØ§Ø±ØªÙƒ ğŸ”
            {% else %}
            Search Cars ğŸ”
            {% endif %}
        </h1>
        <p class="text-gray-300">
            {% if LANGUAGE_CODE == 'ar' %}
            ÙˆØ¬Ø¯Ù†Ø§ <span class="text-gold">{{ total_count }}</span> Ø³ÙŠØ§Ø±Ø©
            {% else %}
            Found <span class="text-gold">{{ total_count }}</span> cars
            {% endif %}
        </p>
    </div>

    <div class="row">
        <!-- Filters Sidebar -->
        <div class="col-lg-3 mb-4">
            <div class="glass-card p-4" style="position: sticky; top: 100px;">
                <form method="GET" action="{% url 'core:search' %}" id="searchForm">

                    <!-- Keyword Search -->
                    <div class="mb-4">
                        <label class="form-label text-white fw-bold">
                            {% if LANGUAGE_CODE == 'ar' %}Ø¨Ø­Ø« Ø¨Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©{% else %}Keyword Search{% endif %}
                        </label>
                        <input type="text" name="q" class="form-control"
                            placeholder="{% if LANGUAGE_CODE == 'ar'  %}Ù…Ø«Ø§Ù„: ØªÙˆÙŠÙˆØªØ§ ÙƒØ§Ù…Ø±ÙŠ{% else %}e.g., Toyota Camry{% endif %}"
                            value="{{ filters.q }}">
                    </div>

                    <hr style="border-color: var(--midnight-600);">

                    <!-- Essential Filters Section -->
                    <h5 class="text-gold mb-3">
                        {% if LANGUAGE_CODE == 'ar' %}ÙÙ„Ø§ØªØ± Ø£Ø³Ø§Ø³ÙŠØ©{% else %}Essential Filters{% endif %}
                    </h5>

                    <!-- Make & Model -->
                    <div class="mb-3">
                        <label class="form-label text-white">
                            {% if LANGUAGE_CODE == 'ar' %}Ø§Ù„Ù…Ø§Ø±ÙƒØ©{% else %}Make{% endif %}
                        </label>
                        <select name="make" id="makeSelect" class="form-select"
                            onchange="loadModelsForSearch(this.value)">
                            <option value="">{% if LANGUAGE_CODE == 'ar' %}ÙƒÙ„ Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª{% else %}All Makes{% endif %}
                            </option>
                            {% for make in makes %}
                            <option value="{{ make.id }}" {% if filters.make == make.id|stringformat:"s" %}selected{% endif %}>{% if LANGUAGE_CODE == 'ar' %}{{ make.name_ar }}{% else %}{{ make.name_en }}{% endif %}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label text-white">
                            {% if LANGUAGE_CODE == 'ar' %}Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„{% else %}Model{% endif %}
                        </label>
                        <select name="model" id="modelSelect" class="form-select">
                            <option value="">{% if LANGUAGE_CODE == 'ar' %}ÙƒÙ„ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª{% else %}All Models{% endif %}
                            </option>
                            {% for model in models %}
                            <option value="{{ model.id }}" {% if filters.model == model.id|stringformat:"s" %}selected{% endif %}>{% if LANGUAGE_CODE == 'ar' %}{{ model.name_ar }}{% else %}{{ model.name_en }}{% endif %}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Price Range -->
                    <div class="mb-3">
                        <label class="form-label text-white">
                            {% if LANGUAGE_CODE == 'ar' %}Ø§Ù„Ø³Ø¹Ø± (Ø¬Ù†ÙŠÙ‡){% else %}Price (EGP){% endif %}
                        </label>
                        <div class="row g-2">
                            <div class="col-6">
                                <input type="number" name="min_price" class="form-control"
                                    placeholder="{% if LANGUAGE_CODE == 'ar'  %}Ù…Ù†{% else %}Min{% endif %}"
                                    value="{{ filters.min_price }}">
                            </div>
                            <div class="col-6">
                                <input type="number" name="max_price" class="form-control"
                                    placeholder="{% if LANGUAGE_CODE == 'ar'  %}Ø¥Ù„Ù‰{% else %}Max{% endif %}"
                                    value="{{ filters.max_price }}">
                            </div>
                        </div>
                        <!-- Quick price buttons -->
                        <div class="d-flex flex-wrap gap-1 mt-2">
                            <button type="button" class="btn btn-sm btn-outline-light" onclick="setPrice(0, 100000)">
                                {% if LANGUAGE_CODE == 'ar' %}Ø£Ù‚Ù„ Ù…Ù† 100 Ø£Ù„Ù{% else %}&lt; 100K{% endif %}
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-light"
                                onclick="setPrice(100000, 300000)">100K-300K</button>
                            <button type="button" class="btn btn-sm btn-outline-light"
                                onclick="setPrice(300000, 500000)">300K-500K</button>
                            <button type="button" class="btn btn-sm btn-outline-light"
                                onclick="setPrice(500000, null)">500K+</button>
                        </div>
                    </div>

                    <!-- Year Range -->
                    <div class="mb-3">
                        <label class="form-label text-white">
                            {% if LANGUAGE_CODE == 'ar' %}Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹{% else %}Year{% endif %}
                        </label>
                        <div class="row g-2">
                            <div class="col-6">
                                <select name="min_year" class="form-select">
                                    <option value="">{% if LANGUAGE_CODE == 'ar' %}Ù…Ù†{% else %}From{% endif %}</option>
                                    <option value="2024" {% if filters.min_year == "2024" %}selected{% endif %}>2024
                                    </option>
                                    <option value="2023" {% if filters.min_year == "2023" %}selected{% endif %}>2023
                                    </option>
                                    <option value="2022" {% if filters.min_year == "2022" %}selected{% endif %}>2022
                                    </option>
                                    <option value="2021" {% if filters.min_year == "2021" %}selected{% endif %}>2021
                                    </option>
                                    <option value="2020" {% if filters.min_year == "2020" %}selected{% endif %}>2020
                                    </option>
                                    <option value="2019" {% if filters.min_year == "2019" %}selected{% endif %}>2019
                                    </option>
                                    <option value="2018" {% if filters.min_year == "2018" %}selected{% endif %}>2018
                                    </option>
                                    <option value="2017" {% if filters.min_year == "2017" %}selected{% endif %}>2017
                                    </option>
                                    <option value="2016" {% if filters.min_year == "2016" %}selected{% endif %}>2016
                                    </option>
                                    <option value="2015" {% if filters.min_year == "2015" %}selected{% endif %}>2015
                                    </option>
                                </select>
                            </div>
                            <div class="col-6">
                                <select name="max_year" class="form-select">
                                    <option value="">{% if LANGUAGE_CODE == 'ar' %}Ø¥Ù„Ù‰{% else %}To{% endif %}</option>
                                    <option value="2024" {% if filters.max_year == "2024" %}selected{% endif %}>2024
                                    </option>
                                    <option value="2023" {% if filters.max_year == "2023" %}selected{% endif %}>2023
                                    </option>
                                    <option value="2022" {% if filters.max_year == "2022" %}selected{% endif %}>2022
                                    </option>
                                    <option value="2021" {% if filters.max_year == "2021" %}selected{% endif %}>2021
                                    </option>
                                    <option value="2020" {% if filters.max_year == "2020" %}selected{% endif %}>2020
                                    </option>
                                    <option value="2019" {% if filters.max_year == "2019" %}selected{% endif %}>2019
                                    </option>
                                    <option value="2018" {% if filters.max_year == "2018" %}selected{% endif %}>2018
                                    </option>
                                    <option value="2017" {% if filters.max_year == "2017" %}selected{% endif %}>2017
                                    </option>
                                    <option value="2016" {% if filters.max_year == "2016" %}selected{% endif %}>2016
                                    </option>
                                    <option value="2015" {% if filters.max_year == "2015" %}selected{% endif %}>2015
                                    </option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Location -->
                    <div class="mb-3">
                        <label class="form-label text-white">
                            {% if LANGUAGE_CODE == 'ar' %}Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©{% else %}Governorate{% endif %}
                        </label>
                        <select name="governorate" class="form-select">
                            <option value="">{% if LANGUAGE_CODE == 'ar' %}ÙƒÙ„ Ù…ØµØ±{% else %}All Egypt{% endif %}</option>
                            {% for code, name in governorates %}
                            <option value="{{ code }}" {% if filters.governorate == code %}selected{% endif %}>
                                {{ name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <hr style="border-color: var(--midnight-600);">

                    <!-- Advanced Filters (Collapsible) -->
                    <div class="mb-3">
                        <button class="btn btn-link text-gold p-0 w-100 text-start" type="button"
                            data-bs-toggle="collapse" data-bs-target="#advancedFilters">
                            <h5 class="mb-0">
                                {% if LANGUAGE_CODE == 'ar' %}ÙÙ„Ø§ØªØ± Ù…ØªÙ‚Ø¯Ù…Ø©{% else %}Advanced Filters{% endif %}
                                <i class="bi bi-chevron-down float-end"></i>
                            </h5>
                        </button>
                    </div>

                    <div class="collapse" id="advancedFilters">
                        <!-- Transmission -->
                        <div class="mb-3">
                            <label class="form-label text-white">
                                {% if LANGUAGE_CODE == 'ar' %}Ù†Ø§Ù‚Ù„ Ø§Ù„Ø­Ø±ÙƒØ©{% else %}Transmission{% endif %}
                            </label>
                            <select name="transmission" class="form-select">
                                <option value="">{% if LANGUAGE_CODE == 'ar' %}Ø§Ù„ÙƒÙ„{% else %}All{% endif %}</option>
                                <option value="AUTO" {% if filters.transmission == "AUTO" %}selected{% endif %}>
                                    {% if LANGUAGE_CODE == 'ar' %}Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒ{% else %}Automatic{% endif %}
                                </option>
                                <option value="MANUAL" {% if filters.transmission == "MANUAL" %}selected{% endif %}>
                                    {% if LANGUAGE_CODE == 'ar' %}Ù…Ø§Ù†ÙŠÙˆØ§Ù„{% else %}Manual{% endif %}
                                </option>
                            </select>
                        </div>

                        <!-- Fuel Type -->
                        <div class="mb-3">
                            <label class="form-label text-white">
                                {% if LANGUAGE_CODE == 'ar' %}Ù†ÙˆØ¹ Ø§Ù„ÙˆÙ‚ÙˆØ¯{% else %}Fuel Type{% endif %}
                            </label>
                            <select name="fuel_type" class="form-select">
                                <option value="">{% if LANGUAGE_CODE == 'ar' %}Ø§Ù„ÙƒÙ„{% else %}All{% endif %}</option>
                                <option value="PETROL" {% if filters.fuel_type == "PETROL" %}selected{% endif %}>
                                    {% if LANGUAGE_CODE == 'ar' %}Ø¨Ù†Ø²ÙŠÙ†{% else %}Petrol{% endif %}
                                </option>
                                <option value="DIESEL" {% if filters.fuel_type == "DIESEL" %}selected{% endif %}>
                                    {% if LANGUAGE_CODE == 'ar' %}Ø³ÙˆÙ„Ø§Ø±{% else %}Diesel{% endif %}
                                </option>
                                <option value="ELECTRIC" {% if filters.fuel_type == "ELECTRIC" %}selected{% endif %}>
                                    {% if LANGUAGE_CODE == 'ar' %}ÙƒÙ‡Ø±Ø¨Ø§Ø¡{% else %}Electric{% endif %}
                                </option>
                                <option value="HYBRID" {% if filters.fuel_type == "HYBRID" %}selected{% endif %}>
                                    {% if LANGUAGE_CODE == 'ar' %}Ù‡Ø§ÙŠØ¨Ø±Ø¯{% else %}Hybrid{% endif %}
                                </option>
                            </select>
                        </div>

                        <!-- Mileage -->
                        <div class="mb-3">
                            <label class="form-label text-white">
                                {% if LANGUAGE_CODE == 'ar' %}Ø§Ù„Ù…Ù…Ø´Ù‰ (ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰){% else %}Max Mileage (km){% endif %}
                            </label>
                            <input type="number" name="max_mileage" class="form-control"
                                placeholder="{% if LANGUAGE_CODE == 'ar'  %}Ù…Ø«Ø§Ù„: 100000{% else %}e.g., 100000{% endif %}"
                                value="{{ filters.max_mileage }}">
                            <div class="d-flex flex-wrap gap-1 mt-2">
                                <button type="button" class="btn btn-sm btn-outline-light"
                                    onclick="setMileage(50000)">50K</button>
                                <button type="button" class="btn btn-sm btn-outline-light"
                                    onclick="setMileage(100000)">100K</button>
                                <button type="button" class="btn btn-sm btn-outline-light"
                                    onclick="setMileage(150000)">150K</button>
                            </div>
                        </div>

                        <!-- Color -->
                        <div class="mb-3">
                            <label class="form-label text-white">
                                {% if LANGUAGE_CODE == 'ar' %}Ø§Ù„Ù„ÙˆÙ†{% else %}Color{% endif %}
                            </label>
                            <select name="color" class="form-select">
                                <option value="">{% if LANGUAGE_CODE == 'ar' %}Ø§Ù„ÙƒÙ„{% else %}All Colors{% endif %}
                                </option>
                                <option value="White" {% if filters.color == "White" %}selected{% endif %}>
                                    {% if LANGUAGE_CODE == 'ar' %}Ø£Ø¨ÙŠØ¶{% else %}White{% endif %}
                                </option>
                                <option value="Black" {% if filters.color == "Black" %}selected{% endif %}>
                                    {% if LANGUAGE_CODE == 'ar' %}Ø£Ø³ÙˆØ¯{% else %}Black{% endif %}
                                </option>
                                <option value="Silver" {% if filters.color == "Silver" %}selected{% endif %}>
                                    {% if LANGUAGE_CODE == 'ar' %}ÙØ¶ÙŠ{% else %}Silver{% endif %}
                                </option>
                                <option value="Gray" {% if filters.color == "Gray" %}selected{% endif %}>
                                    {% if LANGUAGE_CODE == 'ar' %}Ø±Ù…Ø§Ø¯ÙŠ{% else %}Gray{% endif %}
                                </option>
                                <option value="Red" {% if filters.color == "Red" %}selected{% endif %}>
                                    {% if LANGUAGE_CODE == 'ar' %}Ø£Ø­Ù…Ø±{% else %}Red{% endif %}
                                </option>
                                <option value="Blue" {% if filters.color == "Blue" %}selected{% endif %}>
                                    {% if LANGUAGE_CODE == 'ar' %}Ø£Ø²Ø±Ù‚{% else %}Blue{% endif %}
                                </option>
                            </select>
                        </div>

                        <!-- Seller Type -->
                        <div class="mb-3">
                            <label class="form-label text-white">
                                {% if LANGUAGE_CODE == 'ar' %}Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø§Ø¦Ø¹{% else %}Seller Type{% endif %}
                            </label>
                            <select name="seller_type" class="form-select">
                                <option value="">{% if LANGUAGE_CODE == 'ar' %}Ø§Ù„ÙƒÙ„{% else %}All{% endif %}</option>
                                <option value="dealer" {% if filters.seller_type == "dealer" %}selected{% endif %}>
                                    {% if LANGUAGE_CODE == 'ar' %}Ù…Ø¹Ø±Ø¶ Ù…ÙˆØ«ÙˆÙ‚{% else %}Verified Dealer{% endif %}
                                </option>
                                <option value="private" {% if filters.seller_type == "private" %}selected{% endif %}>
                                    {% if LANGUAGE_CODE == 'ar' %}Ø¨Ø§Ø¦Ø¹ Ø®Ø§Øµ{% else %}Private Seller{% endif %}
                                </option>
                            </select>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn-primary">
                            <i class="bi bi-funnel"></i>
                            {% if LANGUAGE_CODE == 'ar' %}ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±{% else %}Apply Filters{% endif %}
                        </button>
                        <button type="button" class="btn-secondary" onclick="clearFilters()">
                            <i class="bi bi-x-circle"></i>
                            {% if LANGUAGE_CODE == 'ar' %}Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„{% else %}Clear All{% endif %}
                        </button>
                    </div>
                </form>

                <!-- Buying Guides Section -->
                <div class="mt-4 p-3"
                    style="background: var(--midnight-700); border-radius: var(--radius-md); border: 1px solid var(--amber-gold);">
                    <h6 class="text-gold mb-3">
                        ğŸ’¡ {% if LANGUAGE_CODE == 'ar' %}Ù†ØµØ§Ø¦Ø­ Ø§Ù„Ø´Ø±Ø§Ø¡{% else %}Buying Tips{% endif %}
                    </h6>
                    <ul class="text-white mb-0" style="font-size: 0.875rem; padding-left: 1.25rem;">
                        {% if LANGUAGE_CODE == 'ar' %}
                        <li class="mb-2"><strong>Ø§ÙØ­Øµ Ø§Ù„Ø³ÙŠØ§Ø±Ø©:</strong> ØªØ£ÙƒØ¯ Ù…Ù† ÙØ­Øµ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø¹Ù†Ø¯ Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ Ù…ÙˆØ«ÙˆÙ‚ Ù‚Ø¨Ù„
                            Ø§Ù„Ø´Ø±Ø§Ø¡.</li>
                        <li class="mb-2"><strong>ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£ÙˆØ±Ø§Ù‚:</strong> Ø±Ø§Ø¬Ø¹ Ø±Ø®ØµØ© Ø§Ù„Ø³ÙŠØ§Ø±Ø© ÙˆØ§Ù„ÙØ­Øµ Ø§Ù„Ø¯ÙˆØ±ÙŠ ÙˆØ§Ù„ØªØ£Ù…ÙŠÙ†.
                        </li>
                        <li class="mb-2"><strong>Ù‚Ø§Ø±Ù† Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:</strong> Ø§Ø¨Ø­Ø« Ø¹Ù† Ø³ÙŠØ§Ø±Ø§Øª Ù…Ù…Ø§Ø«Ù„Ø© Ù„ØªØ¹Ø±Ù Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¹Ø§Ø¯Ù„.</li>
                        <li class="mb-2"><strong>Ø§Ø³Ø£Ù„ Ø¹Ù† Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> Ø§Ø³ØªÙØ³Ø± Ø¹Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù„Ø§Ùƒ Ø§Ù„Ø³Ø§Ø¨Ù‚ÙŠÙ† ÙˆØ§Ù„Ø­ÙˆØ§Ø¯Ø«.</li>
                        <li><strong>Ø¬Ø±Ø¨ Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©:</strong> Ù„Ø§ ØªØ´ØªØ±ÙŠ Ø¨Ø¯ÙˆÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© ÙÙŠ Ø¸Ø±ÙˆÙ Ù…Ø®ØªÙ„ÙØ©.</li>
                        {% else %}
                        <li class="mb-2"><strong>Inspect the car:</strong> Have a trusted mechanic check the car before
                            buying.</li>
                        <li class="mb-2"><strong>Verify documents:</strong> Check the registration, inspection, and
                            insurance papers.</li>
                        <li class="mb-2"><strong>Compare prices:</strong> Research similar cars to know the fair market
                            price.</li>
                        <li class="mb-2"><strong>Ask about history:</strong> Inquire about previous owners and accident
                            history.</li>
                        <li><strong>Test drive:</strong> Never buy without testing the car in different conditions.</li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="col-lg-9">
            <!-- Sort & Results Header -->
            <div class="mb-4 d-flex justify-content-between align-items-center flex-wrap gap-3">
                <div>
                    <h5 class="text-white mb-0">
                        {% if LANGUAGE_CODE == 'ar' %}
                        {{ total_count }} Ø³ÙŠØ§Ø±Ø© Ù…ØªØ§Ø­Ø©
                        {% else %}
                        {{ total_count }} Cars Available
                        {% endif %}
                    </h5>
                </div>
                <div>
                    <select name="sort" class="form-select" onchange="this.form.submit()" form="searchForm">
                        <option value="newest" {% if filters.sort == "newest" %}selected{% endif %}>
                            {% if LANGUAGE_CODE == 'ar' %}Ø§Ù„Ø£Ø­Ø¯Ø«{% else %}Newest First{% endif %}
                        </option>
                        <option value="price_low" {% if filters.sort == "price_low" %}selected{% endif %}>
                            {% if LANGUAGE_CODE == 'ar' %}Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø£Ø¹Ù„Ù‰{% else %}Price: Low to High{% endif %}
                        </option>
                        <option value="price_high" {% if filters.sort == "price_high" %}selected{% endif %}>
                            {% if LANGUAGE_CODE == 'ar' %}Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø£Ù‚Ù„{% else %}Price: High to Low{% endif %}
                        </option>
                        <option value="mileage_low" {% if filters.sort == "mileage_low" %}selected{% endif %}>
                            {% if LANGUAGE_CODE == 'ar' %}Ø§Ù„Ù…Ù…Ø´Ù‰: Ø§Ù„Ø£Ù‚Ù„{% else %}Mileage: Low to High{% endif %}
                        </option>
                        <option value="year_new" {% if filters.sort == "year_new" %}selected{% endif %}>
                            {% if LANGUAGE_CODE == 'ar' %}Ø§Ù„Ø³Ù†Ø©: Ø§Ù„Ø£Ø­Ø¯Ø«{% else %}Year: Newest{% endif %}
                        </option>
                        <option value="views" {% if filters.sort == "views" %}selected{% endif %}>
                            {% if LANGUAGE_CODE == 'ar' %}Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø´Ø§Ù‡Ø¯Ø©{% else %}Most Viewed{% endif %}
                        </option>
                    </select>
                </div>
            </div>

            <!-- Listings Grid -->
            <div class="row g-4">
                {% if listings %}
                {% for listing in listings %}
                <div class="col-md-6 col-lg-6">
                    <div class="listing-card h-100 p-2">
                        <a href="{% url 'core:listing_detail' listing.pk %}" class="text-decoration-none">
                            <!-- Image Container with zoom -->
                            <div class="listing-card-image">
                                {% if listing.image_main|has_file %}
                                <img src="{{ listing.image_main.url }}" alt="{{ listing.trim.model.name_en }}"
                                    loading="lazy">
                                {% else %}
                                <div class="w-100 h-100 d-flex align-items-center justify-content-center">
                                    <i class="bi bi-car-front"
                                        style="font-size: 4rem; color: var(--electric-blue); opacity: 0.3;"></i>
                                </div>
                                {% endif %}

                                <!-- Price Badge -->
                                <div class="listing-card-price" style="font-size: 1.25rem; font-weight: 700;">
                                    {{ listing.price|intcomma }} <small style="font-size: 0.8rem;">{% if LANGUAGE_CODE == 'ar' %}Ø¬.Ù…{% else %}EGP{% endif %}</small>
                                </div>

                                <!-- Feature Badges (Top Left) -->
                                <div class="position-absolute top-0 start-0 p-2 d-flex flex-column gap-1"
                                    style="z-index: 10;">
                                    {% if listing.trim.fuel_type == 'ELECTRIC' or listing.trim.fuel_type == 'HYBRID' or listing.trim.fuel_type == 'DIESEL' %}
                                    <span class="badge bg-success bg-opacity-90 backdrop-blur shadow-sm">
                                        <i class="bi bi-lightning-charge-fill"></i> {% trans "Fuel Saver" %}
                                    </span>
                                    {% endif %}

                                    {% if listing.mileage < 60000 %} <span
                                        class="badge bg-info bg-opacity-90 backdrop-blur shadow-sm">
                                        <i class="bi bi-speedometer"></i> {% trans "Low Mileage" %}
                                        </span>
                                        {% endif %}
                                </div>
                            </div>

                            <div class="listing-card-body p-4">
                                <h5 class="listing-title mb-3" style="font-size: 1.25rem;">
                                    {% if LANGUAGE_CODE == 'ar' %}
                                    {{ listing.trim.model.make.name_ar }} {{ listing.trim.model.name_ar }}
                                    {% else %}
                                    {{ listing.trim.model.make.name_en }} {{ listing.trim.model.name_en }}
                                    {% endif %}
                                </h5>

                                <div class="listing-meta mb-3">
                                    <span class="listing-meta-item">
                                        <i class="bi bi-calendar" style="color: var(--electric-blue);"></i> {{ listing.trim.year }}
                                    </span>
                                    <span class="listing-meta-item">
                                        <i class="bi bi-speedometer2" style="color: var(--amber-gold);"></i> {{ listing.mileage|floatformat:0 }} {% if LANGUAGE_CODE == 'ar' %}ÙƒÙ…{% else %}km{% endif %}
                                    </span>
                                    <span class="listing-meta-item">
                                        <i class="bi bi-gear-wide-connected" style="color: var(--status-verified);"></i>
                                        {{ listing.trim.transmission }}
                                    </span>
                                    <span class="listing-meta-item">
                                        <i class="bi bi-fuel-pump" style="color: var(--status-excellent);"></i> {% if listing.trim.fuel_type == 'PETROL' %}{% trans "Petrol" %}{% elif listing.trim.fuel_type == 'DIESEL' %}{% trans "Diesel" %}{% elif listing.trim.fuel_type == 'ELECTRIC' %}{% trans "Electric" %}{% else %}{% trans "Hybrid" %}{% endif %}
                                    </span>
                                    <span class="listing-meta-item">
                                        <i class="bi bi-geo-alt" style="color: var(--status-below);"></i> {{ listing.get_location_display }}
                                    </span>
                                </div>

                                {% if listing.seller.is_dealer %}
                                <div class="mt-3 pt-3 border-top border-secondary">
                                    <span class="badge badge-verified w-100 justify-content-center">
                                        <i class="bi bi-patch-check-fill"></i> {% trans "Verified Dealer" %}
                                    </span>
                                </div>
                                {% endif %}
                            </div>
                        </a>
                    </div>
                </div>
                {% endfor %}
                {% else %}
                <div class="col-12 text-center py-5">
                    <i class="bi bi-search" style="font-size: 4rem; color: var(--gray-500);"></i>
                    <h3 class="text-white mt-3">
                        {% if LANGUAGE_CODE == 'ar' %}Ù„Ù… Ù†Ø¬Ø¯ Ù†ØªØ§Ø¦Ø¬{% else %}No results found{% endif %}
                    </h3>
                    <p class="text-gray-400">
                        {% if LANGUAGE_CODE == 'ar' %}
                        Ø¬Ø±Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙÙ„Ø§ØªØ± Ø£Ùˆ Ø§Ù„Ø¨Ø­Ø« Ø¨ÙƒÙ„Ù…Ø§Øª Ø£Ø®Ø±Ù‰
                        {% else %}
                        Try adjusting your filters or search with different keywords
                        {% endif %}
                    </p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
    function loadModelsForSearch(makeId) {
        const modelSelect = document.getElementById('modelSelect');
        modelSelect.innerHTML = '<option value="">{% if LANGUAGE_CODE == "ar"  %}Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...{% else %}Loading...{% endif %}</option>';

        if (!makeId) {
            modelSelect.innerHTML = '<option value="">{% if LANGUAGE_CODE == "ar"  %}ÙƒÙ„ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª{% else %}All Models{% endif %}</option>';
            return;
        }

        const langCode = '{% if LANGUAGE_CODE == "ar"  %}ar{% else %}en{% endif %}';
        fetch('/' + langCode + '/ajax/load-models/?make_id=' + makeId)
            .then(response => response.json())
            .then(data => {
                modelSelect.innerHTML = '<option value="">{% if LANGUAGE_CODE == "ar"  %}ÙƒÙ„ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª{% else %}All Models{% endif %}</option>';
                data.forEach(model => {
                    const option = document.createElement('option');
                    option.value = model.id;
                    option.textContent = model.name;
                    modelSelect.appendChild(option);
                });
            });
    }

    function setPrice(min, max) {
        document.querySelector('input[name="min_price"]').value = min || '';
        document.querySelector('input[name="max_price"]').value = max || '';
    }

    function setMileage(value) {
        document.querySelector('input[name="max_mileage"]').value = value;
    }

    function clearFilters() {
        window.location.href = search" %}';
    }
</script>
{% endblock %}